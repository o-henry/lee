---
title: STEP BY STEP 
date: '2024-09-30'
tags: ['iOS', 'swftUI']
draft: true
summary: ''
---

# goal

* 영화 리스트를 제공하는 서비스를 구현해봅니다.
* 현재 상영중인 최신 영화 정보를 확인하는 비즈니스만 구현해봅니다.
* high cohesion and low coupling 을 유지합니다.
* 테스트 : 비즈니스 로직과 앱의 중요한 부분 위주로 테스트를 작성합니다.
	* 테스트 커버리지 퍼센티지에 연연하지 말고 서비스에 주요 비즈니스 로직에 집중합니다.
	* 예를들어 결제서비스 같은 경우 테스트 커버리지가 높을수록 좋겠죠?
* 디자인 패턴과 SOLID 원칙
	* 패턴과 원칙에 너무 매몰되지 않도록 주의합니다.
	* 예를들어, DRY를 강조하지만, 앱을 구현 초기부터 재사용성을 염두에 두면서 개발하는 것은 오버엔지니어링이 될 수 있습니다.
	* 변화나 수정이 필요한 부분이 보이면 그 때 고치는 방식으로 접근하면 됩니다.
* 코드가 유연한가 (변화에 대처하기 쉬운가)
* POP
* 최대한 Functional하게 FP 흉내내기..



<br />
<br />

# Architecture

* Clean Architecture with MVVM 
	* adapter가 변경될때 유연하게 변경할 수 있습니다.
	* The main rule is not to have dependencies from inner layers to outers layers
* 레이어는 폴더(group)으로 구분합니다.
* Feature Grouping 로 프로젝트를 구성합니다.
	* 기능별로 파일을 분리하면 같은 목적의 코드들이 포함되어 있기 때문에 높은 응집도 와 낮은 결합력 유지하게 됩니다.
	* feature grouping의 단점은 계층에 의한 패키징 방식 보다 아키텍처 가시성을 떨어트린다는 단점이 있습니다.

<br />
<br />

# recognize user story

앱의 비즈니스와 도메인을 식별하는 방법은 사용자의 관점으로 접근하는 것 입니다.
User story는 사용자 관점으로 소프트웨어(앱)의 기능에 대한 설명을 캡처하는 방법입니다. 이 스토리에는 기술적 요소는 포함되지 않아야 하며 사용자가 원하는 동작에 대해서 집중해야 합니다.

* 사용자는 최신 영화 정보를 확인할 수 있습니다.
* 사용자는 영화를 관람 후 평가를 내릴 수 있습니다.
* 사용자는 영화 리뷰를 남길 수 있습니다.


<br />
<br />

# DATA flow

* 

<br />
<br />

# recognize domain

* 우선 애플리케이션을 빌드하는데 필요로하는 기능을 식별합니다. 기능을 식별한 후에 UI를 레이아웃하고 각 기능에 따른 뷰를 배치합니다. 

* NOW PLAYING
	1. 현재 상영중인 최신 영화 정보를 확인할 수 있어야 합니다.

<br />

**TEST**
 * 테스트 고민해보기 
   `영화 정보를 확인할 수 있습니다` 라는 비즈니스 로직을 테스트 한다고 생각해보면 네트워크 요청을 하고 response 를 제대로 가져오는지를 테스트 해볼 수 있습니다. 이때 Mocking 을 활용하는 등의 방식을 사용할 수 있습니다.

<br />

**WALKING SKELETON**

워킹 스켈레톤은 작은 종단 간 기능을 수행하는 시스템의 작은 구현체입니다. 최종 아키텍처를 사용할 필요는 없지만 주요 아키텍처 구성 요소를 서로 연결해야 합니다. 그런 다음 아키텍처와 기능은 병렬로 진화할 수 있습니다. 이를 구현하면 보다 쉬운 테스트가 가능해집니다.

> * 각 레이어에서 작동하는 작은 단위의 모듈을 생성합니다.
> * 더 쉬운 테스트를 할 수 있게 도와줍니다.

* 외부 Rest API (예제의 경우는 영화 api)를 활용합니다. 이에 따른 Configuration을 준비합니다.
* 영화 데이터를 가져오기 위해서 API KEY를 추가합니다.
	**API KEY 관리**
	API KEY는 시크릿 키 이기 때문에 깃허브에 올리기전에 숨겨야 합니다.
	이를 구현하기 위해 `.xcconfig` 를 활용합니다.

<br />

**MOCK.json**

도메인 모델의 Mock.json을 생성해봅니다.
Q. Mock.json 을 생성하는 이유는?
A. 개발중에 앱을 실행할 때 외부 데이터에 의존하지 않고 비즈니스 로직을 테스트하고 디자인을 반복(preview) 하는데 유용하기 때문입니다. 

Mock.json은 앱 파일의 Preview Content 내부에 생성합니다. Mock의 경우 API의 Response를 모킹하면 됩니다.

> xcode에 `Preview Content` 폴더(그룹)에 Mock.json 파일을 추가하여 사용합니다. 여기에 Xcode 프리뷰에 사용할 mock 코드와 데이터를 추가할 수 있습니다. 나중에 앱을 컴파일할 때 Xcode는 빌드에 이 그룹의 컨텐츠를 포함하지 않습니다. 이렇게 하면 이미지 및 기타 데이터와 같은 개발 에셋을 프로젝트 내부에 저장할 수 있으며, 앱을 어수선하게 만드는 것에 대해 걱정할 필요가 없습니다.

<br />
<br />

# implementation
 
도메인 모델을 구현하는데 접근하는 가장 쉬운 방법은 서버의 API를 확인하는 것입니다. 대부분의 경우 앱에는 데이터를 처리할 수 있는 백엔드 웹 서비스가 있습니다. 백엔드 모델을 일치시키면 일반적으로 JSON에서 도메인으로 변환할 수 있습니다.

* API에 맞춰 도메인을 구현합니다.
* 다만 이러한 방식의 문제점은 엔티티가 api 종속적인 즉, api스펙에 따라 변경된다는 문제가 발생합니다. 이에 따라서 DTO를 활용하는 방법도 있습니다.

**DTO**
> DTO는 다른 클래스혹은 계층으로 데이터를 전달할 때 도메인 모델 대신 사용되는 객체 입니다.

현재 영화 서비스는 식별한 유저스토리 "사용자는 최신 영화정보를 확인할 수 있습니다." 를 통해 네트워크 요청 과 I/O 작업이 필요하다는걸 식별할 수 있습니다. 

따라서 첫번째 구현은 Core/Data/API 레이어가 되겠습니다. 코드(네트워크 레이어)를 구현할때 신경써야할 부분을 미리 작성해봅니다.

1. 높은 응집도.
2. 낮은 결합력. (관련 있는 코드들은 같은 곳에, 의존성은 적게)
3. 사이드 이펙트를 최소화 하기.
4. SOLID ..

<br />
<br />

## DATA LAYER - Networking

Clean Architecture에서 데이터 레이어의 역할은 데이터 소스와의 상호작용 입니다. 데이터 소스는 데이터베이스 일 수도 있고, 외부 API SERVER 일 수 도 있습니다. 데이터 레이어는 데이터 소비자와 소스 간의 추상화 레이어 역할을 하므로 소비자는 데이터 조작의 복잡성에 대해 걱정할 필요가 없으며 데이터 레이어를 사용하면 다른 영향을 미치거나 손상되지 않고 데이터 소스를 더 쉽게 변경할 수 있습니다. (데이터베이스를 변경해야할 상황이 온다고 가정했을 때 저런 문제를 걱정하지 않고 교체할 수 있음을 의미합니다.)

> 쉽게 말하면 외부(DB)에 요청하여 I/O를 처리(데이터 CRUD)하는 레이어입니다.

파일 구조에서 Group(폴더)을 layer로 인식하면 됩니다. Core/Data/API 의 경우 data layer 와 연관된 network 레이어 코드들을 정의합니다.



코드 구현후 체크리스트는 아래와 같습니다.

1. 비동기로 작동하는가?
2. 데이터가 제대로 fetching 되는가?
3. fetching한 데이터가 제대로 파싱되는가?
4. 테스트가 통과하는가?



<br />
<br />


# Role

* **SERVICE** 
	* 서비스 레이어의 역할은 decoupling code and separating concerns from view model.



<br />
<br />

# Testing

* unit-test의 경우 swift testing을 사용하고 UI test의 경우 기존 XCTest를 활용한다.

<br />
<br />

# ETC

* 깃 전략
* tuist 사용
* CI/CD
* 문서화
* 코드 리뷰
* 성능 테스트 (profiling)
* 디버깅
* 유지보수 
* A/B 테스팅


<br />
<br />

# QNA

Q. MVVM에서 ViewModel의 역할에 대하여
Q. MVI 나 MV로 변경한다면?